# vi: set syntax=make:

#####################################################################
# Target Platform
#####################################################################
CONFIG_TARGET_qualcommax=y
CONFIG_TARGET_qualcommax_ipq807x=y
CONFIG_TARGET_qualcommax_ipq807x_DEVICE_linksys_mx4300=y

#####################################################################
# NSS Offloading
#####################################################################
# NOTE: qca-nss-drv, qca-nss-ecm, qca-nss-drv-bridge-mgr and
# qca-nss-drv-vlan-mgr don't need to be explicitly selected, as they
# are automatically selected by the target platform.

# NSS Mesh Support (NSS FW 11.4 ONLY)
CONFIG_ATH11K_NSS_MESH_SUPPORT=y

# QCA Multicast Snooping (ECM)
CONFIG_PACKAGE_kmod-qca-mcs=y

# NSS SQM Traffic Shaping
CONFIG_PACKAGE_sqm-scripts-nss=y

#####################################################################
# Additional NSS Configuration
#####################################################################
CONFIG_PACKAGE_kmod-qca-nss-drv-pppoe=y

#####################################################################
# Compiler and Toolchain Optimization
#####################################################################
CONFIG_BINUTILS_USE_VERSION_2_45=y
CONFIG_CCACHE=y
CONFIG_DEVEL=y
CONFIG_GCC_USE_GRAPHITE=y
CONFIG_GCC_USE_VERSION_15=y
CONFIG_TARGET_OPTIMIZATION="-O2 -pipe -mcpu=cortex-a53+crc+crypto"
CONFIG_TARGET_OPTIONS=y
CONFIG_TOOLCHAINOPTS=y
CONFIG_USE_GC_SECTIONS=y
CONFIG_USE_LTO=y
CONFIG_USE_MOLD=y
CONFIG_ZLIB_OPTIMIZE_SPEED=y
CONFIG_ZSTD_OPTIMIZE_O3=y

#####################################################################
# Kernel Build Options
#####################################################################
CONFIG_BUILD_PATENTED=y
CONFIG_EXPERIMENTAL=y

#####################################################################
# Security Hardening Options
#####################################################################
CONFIG_KERNEL_CC_STACKPROTECTOR_STRONG=y
CONFIG_PKG_ASLR_PIE_ALL=y
CONFIG_PKG_CC_STACKPROTECTOR_ALL=y
CONFIG_PKG_CHECK_FORMAT_SECURITY=y
CONFIG_PKG_FORTIFY_SOURCE_3=y
CONFIG_PKG_RELRO_FULL=y
CONFIG_USE_SECCOMP=y

#####################################################################
# SSL and Cryptography Configuration
#####################################################################
# Use OpenSSL as the preferred SSL library across all packages
# This ensures consistency and avoids mixed SSL library issues
CONFIG_LUA_ECO_MBEDTLS=n
CONFIG_LUA_ECO_OPENSSL=y
CONFIG_OPENSSL_OPTIMIZE_SPEED=y
CONFIG_PACKAGE_apk-mbedtls=n
CONFIG_PACKAGE_apk-openssl=y
CONFIG_PACKAGE_libopenssl=y
CONFIG_PACKAGE_libustream-mbedtls=n
CONFIG_PACKAGE_libustream-openssl=y
CONFIG_PACKAGE_luci-ssl-openssl=y

#####################################################################
# Wireless Configuration
#####################################################################
# Enable WPA3 and Mesh support
CONFIG_PACKAGE_wpad-mesh-openssl=y
# Avoid using mbedTLS for consistency across packages and to avoid mixed SSL libraries.
CONFIG_PACKAGE_wpad-basic-mbedtls=n

#####################################################################
# Feeds Configuration
#####################################################################
# Prevent package manager from adding custom feeds as repositories in final image.
# They don't exist upstream and will cause errors when trying to update
CONFIG_FEED_nss_packages=n
CONFIG_FEED_sqm_scripts_nss=n

#####################################################################
# LUCI Web Interface
#####################################################################
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-mod-status-nss=y

#####################################################################
# LUCI Applications
#####################################################################
CONFIG_PACKAGE_luci-app-firewall=y
CONFIG_PACKAGE_luci-app-package-manager=y
CONFIG_PACKAGE_luci-app-sqm=y
CONFIG_PACKAGE_luci-app-ttyd=y

#####################################################################
# Network Utilities
#####################################################################
CONFIG_PACKAGE_curl=y
CONFIG_LIBCURL_MBEDTLS=n
CONFIG_LIBCURL_OPENSSL=y
CONFIG_PACKAGE_iperf3=y
CONFIG_PACKAGE_tailscale=y
CONFIG_PACKAGE_rsync=y
CONFIG_PACKAGE_jq=y
CONFIG_PACKAGE_pigz=y
CONFIG_PACKAGE_tar=y
CONFIG_PACKAGE_tcpdump=y

#####################################################################
# Kernel Modules
#####################################################################
CONFIG_PACKAGE_kmod-fs-ntfs3=y
CONFIG_PACKAGE_kmod-fs-vfat=y
CONFIG_PACKAGE_kmod-tcp-bbr=y
CONFIG_PACKAGE_kmod-tun=y
# Bridge module support for working with nftables for more complex firewall setups
CONFIG_PACKAGE_kmod-nft-bridge=y
# NOTE: Not all IPQ807x devices have USB ports, so this is optional
CONFIG_PACKAGE_kmod-usb-storage=y
# ramoops: kernel module that logs crashes to RAM which can be read after a reboot
# Check '/sys/fs/pstore' for logs after a crash
CONFIG_PACKAGE_kmod-ramoops=y

#####################################################################
# System Utilities
#####################################################################
CONFIG_PACKAGE_htop=y
# lm-sensors isn't needed for IPQ807x devices
CONFIG_HTOP_LMSENSORS=n

#####################################################################
# Wi-Fi Driver Configuration
#####################################################################
# Disable unnecessary debugging for Wi-Fi driver.
CONFIG_ATH11K_DEBUGFS_HTT_STATS=n
CONFIG_ATH11K_DEBUGFS_STA=n
# Disables thermal throttling support for ath11k.
CONFIG_ATH11K_THERMAL=n
